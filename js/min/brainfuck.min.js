function ASCI(){Memory.call(this),this.next=function(){return this._pointer+=1,this},this.previous=function(){return this._pointer-=1,this},this.get=function(){return void 0!==this._data[this._pointer]?this._data[this._pointer]:0},this.set=function(_value){return _value<0&&(_value=0),this._data[this._pointer]=_value%256,this},this.increase=function(){return void 0!==this._data[this._pointer]?(this._data[this._pointer]+=1,this._data[this._pointer]=this._data[this._pointer]%256):this._data[this._pointer]=1,this},this.decrease=function(){return void 0!==this._data[this._pointer]?this._data[this._pointer]=this._data[this._pointer]>1?this._data[this._pointer]-1:0:this._data[this._pointer]=0,this}}function Memory(){this._pointer=0,this._data={},this.reset=function(){this._pointer=0},this.clear=function(){this._pointer=0,this._data={}}}function Infinite(){Memory.call(this),this.next=function(){return this._pointer+=1,this},this.previous=function(){return this._pointer-=1,this},this.get=function(){return void 0!==this._data[this._pointer]?this._data[this._pointer]:0},this.set=function(_value){return this._data[this._pointer]=_value,this},this.increase=function(){return void 0!==this._data[this._pointer]?this._data[this._pointer]+=1:this._data[this._pointer]=1,this},this.decrease=function(){return void 0!==this._data[this._pointer]?this._data[this._pointer]-=1:this._data[this._pointer]=-1,this}}function Code(){this._pointer=0,this._source={},this._brackets={},this.get=function(){return this._pointer>=this._source.length?void 0:this._source[this._pointer]},this.next=function(){return this._pointer+=1,this.get()},this.previous=function(){return this._pointer-=1,this.get()},this.jumpMatching=function(){return void 0!==this._brackets[this._pointer]&&(this._pointer=this._brackets[this._pointer]),this},this.reset=function(){this._pointer=0},this.clear=function(){this._pointer=0,this._source={}},this.source=function(_source){return void 0!==_source?(this._source=_source,this._optimize(),this):this._source},this._optimize=function(){var i,opening,opened=[];for(this._brackets={},i=0;i<this._source.length;i+=1)"["===this._source[i]?opened.push(i):"]"===this._source[i]&&(opening=opened.pop(),this._brackets[opening]=i,this._brackets[i]=opening)}}function Brainfuck(_memory){this.memory=_memory,this.code=new Code,this._stop=!1,this._isRunning=!1,this._onOutput=function(_o){process.stdout.write(String.fromCharCode(_o))},this.onOutput=function(_func){return this._onOutput=_func,this},this.onInput=function(_func){return this._onInput=_func,this},this.stop=function(){this._stop=!0},this.isRunning=function(){return this._isRunning},this.reset=function(){return this.memory.reset=0,this.code.reset(),this},this.step=function(_callback){var cmd=this.code.get();return void 0===cmd?(this._run(_callback,!1),!1):(">"===cmd?this.memory.next():"<"===cmd?this.memory.previous():"+"===cmd?this.memory.increase():"-"===cmd?this.memory.decrease():"."===cmd?this._runAsync(this._onOutput,this.memory.get()):","===cmd?this.memory.set(this._run(this._onInput)):"["===cmd&&0===this.memory.get()?this.code.jumpMatching():"]"===cmd&&(this.code.jumpMatching(),this.code.previous()),this.code.next(),this._run(_callback,!0),!0)},this.run=function(_callback){this._isRunning=!0,this._stop?(this._isRunning=!1,this._run(_callback)):(this._stop=this._stop||!this.step(),this._runAsync(this.run,_callback))},this._runAsync=function(){var that=this,args=Array.prototype.slice.call(arguments),func=args.shift();func.apply(that,args)},this._run=function(){var args=args=Array.prototype.slice.call(arguments),func=args.shift();if("function"==typeof func)return func.apply(this,args)}}ASCI.prototype=Object.create(Memory),ASCI.prototype.constructor=ASCI,Infinite.prototype=Object.create(Memory),Infinite.prototype.constructor=Infinite;