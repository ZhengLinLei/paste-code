let setTabSize=size=>{document.querySelectorAll(".textarea div pre code").forEach(textarea=>{textarea.style.tabSize=`${0!=size?size:4}`,textarea.style.MozTabSize=`${0!=size?size:4}`}),tabSize=size},tabSize=4,tabRegex=/\t/g;const ThemeArr=["light","dark","funky","twilight","solarized","night","zll"];let TMP_ID=0;function Out(str){document.querySelector("#"+TMP_ID).innerHTML+=str+"<br>"}window.addEventListener("load",()=>{var lzma=new LZMA("./js/src/lzma_worker.js");const ROOT_url=document.location,WINDOW_CONFIG={parent:document.querySelector(".textarea"),max:4,min:1,label:"Window",current:0,windows:[],codeWindow:[],windows_value:[],lineActive:[]},_getLang=window=>{const _LINES=window.value.split("\n"),firstLine=_LINES[0];if(firstLine.match(/[\!|\?]/)){let arr=firstLine.split(/[\!|\?]/),tmpLang=arr[arr.length-1].toLowerCase();return tmpLang.includes("--\x3e")?tmpLang.replace("--\x3e","").trim():tmpLang}return!1},_update_code=window=>{const index=WINDOW_CONFIG.windows.indexOf(window),codeWindow=WINDOW_CONFIG.codeWindow[index],_LINES=window.value.split("\n");let language=_getLang(window);language&&codeWindow.setAttribute("class",`language-${language}`),tabRegex.test(window.value)&&(window.value=window.value.replaceAll(tabRegex," ".repeat(tabSize))),codeWindow.innerHTML=window.value.replaceAll(new RegExp("&","g"),"&amp;").replaceAll(new RegExp("<","g"),"&lt;"),Prism.highlightElement(codeWindow),document.querySelector(`.w-${index}`).style.setProperty("--padd",_LINES.length>=100?_LINES.length>=1e3?_LINES.length>=1e4?"55px":"45px":"35px":"25px");const lineNumbers=window.parentElement.querySelector(".line-numbers-rows");lineNumbers.innerHTML=Array(_LINES.length).fill("<span></span>").join(""),window===document.activeElement&&_set_lines(window)},_set_lines=(window,delay=-1)=>{const index=window.value.substring(0,window.selectionStart).split("\n").length,lines=window.parentElement.querySelector(".line-numbers-rows");index+delay<lines.children.length&&!lines.children[index+delay].classList.contains("current")&&(_clear_lines(window),lines.children[index+delay].classList.add("current"))},_clear_lines=window=>{const lines=window.parentElement.querySelector(".line-numbers-rows");Array.from(lines.children).forEach(line=>{line.classList.remove("current")})},addWindow=()=>{if(WINDOW_CONFIG.current<WINDOW_CONFIG.max){const windowParent=document.createElement("div"),codeWindow=document.createElement("pre");codeWindow.setAttribute("aria-hidden","true");const code=document.createElement("code"),lineNumbers=document.createElement("span");lineNumbers.setAttribute("aria-hidden","true"),lineNumbers.setAttribute("class","line-numbers-rows no-select"),lineNumbers.innerHTML="<span></span>";const newWindow=document.createElement("textarea");newWindow.setAttribute("class","textarea-main"),newWindow.setAttribute("spellcheck","false"),newWindow.setAttribute("outline","none"),newWindow.setAttribute("autofill","false"),newWindow.setAttribute("autocorrect","off"),newWindow.setAttribute("autocapitalize","off"),newWindow.setAttribute("autocomplete","off"),newWindow.setAttribute("wrap","off"),newWindow.setAttribute("aria-label","Paste Code"),newWindow.setAttribute("tabindex","0"),newWindow.addEventListener("input",()=>_update_code(newWindow)),newWindow.addEventListener("mouseup",()=>_set_lines(newWindow)),("ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0)&&newWindow.addEventListener("touchend",()=>_set_lines(newWindow)),newWindow.addEventListener("scroll",()=>{codeWindow.scrollTo(newWindow.scrollLeft,newWindow.scrollTop),lineNumbers.scrollTo(newWindow.scrollLeft,newWindow.scrollTop)}),newWindow.addEventListener("keydown",e=>{if("Tab"==e.key||9==e.keyCode||9==e.which){e.preventDefault();const start=newWindow.selectionStart;newWindow.value=newWindow.value.substring(0,start)+" ".repeat(tabSize)+newWindow.value.substring(newWindow.selectionEnd),newWindow.selectionStart=newWindow.selectionEnd=start+tabSize,_update_code(newWindow)}if("ArrowUp"!=e.key&&38!=e.keyCode&&38!=e.which||_set_lines(newWindow,delay=-2),"ArrowDown"!=e.key&&40!=e.keyCode&&40!=e.which||_set_lines(newWindow,delay=0),e.altKey&&"l"==e.key||e.altKey&&76==e.keyCode||e.altKey&&76==e.which){e.preventDefault();const start=newWindow.value.substring(0,newWindow.selectionStart).lastIndexOf("\n")+1;let end=newWindow.value.substring(newWindow.selectionEnd).indexOf("\n")+newWindow.selectionEnd;end+=end==newWindow.value.length-1?1:0,newWindow.setSelectionRange(start,end)}}),newWindow.addEventListener("keyup",e=>{"Enter"!=e.key&&13!=e.keyCode&&13!=e.which&&"ArrowUp"!=e.key&&38!=e.keyCode&&38!=e.which&&"ArrowDown"!=e.key&&40!=e.keyCode&&40!=e.which&&"ArrowLeft"!=e.key&&37!=e.keyCode&&37!=e.which&&"ArrowRight"!=e.key&&39!=e.keyCode&&39!=e.which||_set_lines(newWindow)}),newWindow.addEventListener("focusout",()=>{_clear_lines(newWindow)}),codeWindow.appendChild(code),windowParent.appendChild(lineNumbers),windowParent.appendChild(newWindow),windowParent.appendChild(codeWindow),WINDOW_CONFIG.parent.appendChild(windowParent),WINDOW_CONFIG.windows.push(newWindow),WINDOW_CONFIG.current++,WINDOW_CONFIG.codeWindow.push(code),windowParent.classList.add(`w-${WINDOW_CONFIG.current-1}`)}},removeWindow=()=>{WINDOW_CONFIG.current>WINDOW_CONFIG.min&&(WINDOW_CONFIG.parent.removeChild(WINDOW_CONFIG.windows[WINDOW_CONFIG.windows.length-1].parentElement),WINDOW_CONFIG.windows.pop(),WINDOW_CONFIG.codeWindow.pop(),WINDOW_CONFIG.current--)},closeOffer=()=>document.querySelector("body > footer").classList.remove("text-offer");let _toggle_terminal;const __main__=()=>{window.addEventListener("keydown",e=>{((e.metaKey||e.ctrlKey||e.altKey)&&"t"==e.key||(e.metaKey||e.ctrlKey||e.altKey)&&84==e.keyCode||(e.metaKey||e.ctrlKey||e.altKey)&&84==e.which)&&(e.preventDefault(),_toggle_terminal())});const _setTheme=theme=>{ThemeArr.includes(theme)||(theme=ThemeArr[0]),document.body.classList.remove(...ThemeArr),document.body.classList.add(theme),localStorage.setItem("theme",theme)},invert=document.querySelector(".invert-color");invert.addEventListener("click",()=>{document.body.classList.contains("dark")?_setTheme("light"):_setTheme("dark")}),0==WINDOW_CONFIG.current&&addWindow(),document.querySelector("#add-w").addEventListener("click",addWindow),document.querySelector("#remove-w").addEventListener("click",removeWindow),document.querySelectorAll(".generate-url").forEach(btn=>{btn.addEventListener("click",()=>{const btn_type=btn.getAttribute("data-type");WINDOW_CONFIG.windows.forEach((window,index)=>WINDOW_CONFIG.windows_value[index]=window.value),lzma.compress(JSON.stringify(WINDOW_CONFIG.windows_value),1,(compressed,error)=>{if(error)return void alert("Failed to compress data: "+error);let reader=new FileReader;reader.onload=function(){let base64=reader.result.substr(reader.result.indexOf(",")+1),url="https://"+ROOT_url.host+ROOT_url.pathname+"#"+base64;var result="markdown"===btn_type?"[paste]("+url+")":url;navigator.clipboard.writeText(result),document.querySelector(".nav-text-offer input").value=result,document.querySelector("body > footer").classList.add("text-offer")},reader.readAsDataURL(new Blob([new Uint8Array(compressed)]))})})}),document.querySelector("a.cancel-url").addEventListener("click",closeOffer),document.querySelector("a.copy-url").addEventListener("click",()=>{var input;document.querySelector(".nav-text-offer input").select(),document.execCommand("copy"),closeOffer()}),_toggle_terminal=(type="toggle")=>{switch(type){case"open":document.querySelector("#terminal").classList.add("open"),terminal.focus();break;case"close":document.querySelector("#terminal").classList.remove("open");break;case"toggle":document.querySelector("#terminal").classList.toggle("open"),terminal.focus()}localStorage.setItem("terminal",!!document.querySelector("#terminal").classList.contains("open"))};const _ExecPush=()=>{TERMINAL_CONFIG.historyPosition=0;let _input=document.createElement("div");_input.classList.add("terminal-input"),_input.innerHTML=document.querySelector("#terminal-main-input").innerHTML,terminalOutput.appendChild(_input),_input.removeChild(_input.querySelector("button")),_TERMINAL.exec(terminalInput.innerText).then(res=>{if(TERMINAL_CONFIG.position=0,terminalInput.innerHTML="",!res[0]||res[1].length>0){let _output=document.createElement("div");_output.classList.add("terminal-output"),_output.innerHTML=res[1],terminalOutput.appendChild(_output)}terminal.scrollTop=terminal.scrollHeight})},_option_click=e=>{let opt={add:["window add 1",1],remove:["window remove 1",1],exit:["exit",1],clear:["cls",1],help:["help",1],reset:["config reset",1],import:["config set <span class='token comment'>JSON</span>",0],export:["config get",1]};terminalInput.innerHTML=opt[e][0],TERMINAL_CONFIG.position=terminalInput.innerText.length,opt[e][1]&&_ExecPush()},terminal=document.querySelector("#terminal-main"),terminalInput=document.querySelector("#terminal-main-command"),terminalCaret=document.querySelector("#terminal-caret"),terminalOutput=document.querySelector("#terminal-main-history"),TERMINAL_CONFIG={position:0,historyPosition:0};document.querySelector("#open-t").addEventListener("click",()=>_toggle_terminal("open")),document.querySelector("#close-t").addEventListener("click",()=>_toggle_terminal("close")),terminal.addEventListener("focus",()=>{terminal.scrollTop=terminal.scrollHeight,terminalCaret.classList.add("blink")}),terminal.addEventListener("blur",()=>terminalCaret.classList.remove("blink")),terminal.addEventListener("keydown",e=>{if(e.ctrlKey||e.metaKey||e.altKey||(e.preventDefault(),1==e.key.length&&(TERMINAL_CONFIG.position+=1,terminalInput.innerText=terminalInput.innerText.slice(0,TERMINAL_CONFIG.position-1)+e.key+terminalInput.innerText.slice(TERMINAL_CONFIG.position-1))),"ArrowLeft"==e.key&&(TERMINAL_CONFIG.position-=TERMINAL_CONFIG.position>0?1:0),"ArrowRight"==e.key&&(TERMINAL_CONFIG.position+=TERMINAL_CONFIG.position<terminalInput.innerText.length?1:0),"ArrowLeft"==e.key||"ArrowRight"==e.key){let fs=terminalCaret.getBoundingClientRect().width-2*parseFloat(getComputedStyle(terminalCaret,null).getPropertyValue("border-left-width"))-1e-5;terminalCaret.style.transform=`translateX(-${(terminalInput.innerText.length-TERMINAL_CONFIG.position)*fs}px)`}if("ArrowUp"==e.key||"ArrowDown"==e.key){const history=_TERMINAL.getHistory();TERMINAL_CONFIG.historyPosition+="ArrowUp"==e.key?TERMINAL_CONFIG.historyPosition>=history.length?0:1:TERMINAL_CONFIG.historyPosition<=0?0:-1;let _w=history[history.length-TERMINAL_CONFIG.historyPosition];terminalInput.innerText=_w||"",TERMINAL_CONFIG.position=terminalInput.innerText.length}"v"==e.key&&(e.ctrlKey||e.metaKey)&&navigator.clipboard.readText().then(text=>{terminalInput.innerText=terminalInput.innerText.slice(0,TERMINAL_CONFIG.position-1)+text+terminalInput.innerText.slice(TERMINAL_CONFIG.position-1),TERMINAL_CONFIG.position+=text.length}),"Backspace"!=e.key&&"Delete"!=e.key||(terminalInput.innerText=terminalInput.innerText.slice(0,TERMINAL_CONFIG.position-1)+terminalInput.innerText.slice(TERMINAL_CONFIG.position),TERMINAL_CONFIG.position-=0==TERMINAL_CONFIG.position?0:1),"Enter"!=e.key&&"Return"!=e.key&&"NumpadEnter"!=e.key||_ExecPush()}),document.querySelectorAll(".terminal-option").forEach(option=>{option.addEventListener("click",()=>_option_click(option.getAttribute("data-option")))});const _getXY=e=>{if("touchstart"==e.type||"touchmove"==e.type||"touchend"==e.type||"touchcancel"==e.type){var evt=void 0===e.originalEvent?e:e.originalEvent,touch=evt.touches[0]||evt.changedTouches[0];x=touch.pageX,y=touch.pageY}else"mousedown"!=e.type&&"mouseup"!=e.type&&"mousemove"!=e.type&&"mouseover"!=e.type&&"mouseout"!=e.type&&"mouseenter"!=e.type&&"mouseleave"!=e.type||(x=e.clientX,y=e.clientY);return{x:x,y:y}},_fncStartResize=(e,type)=>{let _Y="y"===type,coords=_getXY(e),_PARENT=_Y?terminal.parentElement.parentElement:document.querySelector("#terminal-fast-option"),_MAX=_Y?.8*window.innerHeight:.5*window.innerWidth,_MIN=_Y?.2*window.innerHeight:.1*window.innerWidth,_SIZE=_PARENT.getBoundingClientRect()[_Y?"height":"width"],_START=coords[type];const fncTouch=e2=>{["touchstart","touchmove","touchend","touchcancel"].includes(e.type)||e2.preventDefault();let coordsM=_getXY(e2);document.body.classList.add(_Y?"row-resize":"col-resize");let _NEW_SIZE=_SIZE-(coordsM[type]-_START);_NEW_SIZE>_MIN&&_NEW_SIZE<_MAX&&(_Y?_PARENT.style.height=`${_NEW_SIZE}px`:(document.documentElement||document.querySelector(":root")).style.setProperty("--termOption",`${_NEW_SIZE}px`))};window.onmousemove=fncTouch,window.ontouchmove=fncTouch,window.onmouseup=()=>_fncEndResize(type),window.ontouchend=()=>_fncEndResize(type)},_fncEndResize=type=>{let _Y="y"===type;document.body.classList.remove(_Y?"row-resize":"col-resize"),window.onmousemove=null,window.ontouchmove=null,window.onmouseup=null,window.ontouchend=null,localStorage.setItem(_Y?"terminalHeight":"terminalOptWidth",_Y?terminal.parentElement.parentElement.getBoundingClientRect().height:document.querySelector("#terminal-fast-option").getBoundingClientRect().width)};["mousedown","touchstart"].forEach(evt=>{document.querySelector("#scroll-height.terminal").addEventListener(evt,e=>_fncStartResize(e,"y")),document.querySelector("#scroll-width.terminal-opt").addEventListener(evt,e=>_fncStartResize(e,"x"))});const _TERMINAL=new Terminal({terminal:{main:terminal,input:terminalInput,output:terminalOutput,caret:terminalCaret,toggleFnc:_toggle_terminal,config:TERMINAL_CONFIG},window:{add:addWindow,remove:removeWindow,config:WINDOW_CONFIG,getLang:_getLang},theme:{list:ThemeArr,set:_setTheme}})},_load_config=()=>{if(localStorage.getItem("theme")&&document.body.classList.add(localStorage.getItem("theme")),localStorage.getItem("terminalHeight")){let h=parseFloat(localStorage.getItem("terminalHeight")),_MAX=.8*window.innerHeight,_MIN;h>.2*window.innerHeight&&h<_MAX&&(document.documentElement||document.querySelector(":root")).style.setProperty("--termSize",`${h}px`)}if(localStorage.getItem("terminalOptWidth")){let w=parseFloat(localStorage.getItem("terminalOptWidth")),_MAX=.5*window.innerWidth,_MIN;w>.1*window.innerWidth&&w<_MAX&&(document.documentElement||document.querySelector(":root")).style.setProperty("--termOption",`${w}px`)}if("true"==localStorage.getItem("terminal")&&_toggle_terminal("open"),localStorage.getItem("fontSize")){let size=parseFloat(localStorage.getItem("fontSize"));console.log(size),size>=5&&size<=35&&(document.documentElement||document.querySelector(":root")).style.setProperty("--font-size",`${size}px`)}};fn=async()=>{const compile=()=>{__main__(),_load_config()};let base64=location.hash.substring(1);if(0==base64.length||"undefined"==base64||!fetch)return void compile();let r=await fetch("data:application/octet-stream;base64,"+base64),blob=await r.blob(),reader=new FileReader;reader.onload=function(){var compressed_data=Array.from(new Uint8Array(reader.result));lzma.decompress(compressed_data,(function(plaintext,error){error&&alert("Failed to decompress data: "+error);try{const arrayData=JSON.parse(plaintext);"object"==typeof arrayData&&arrayData.forEach((el,i)=>{addWindow(),WINDOW_CONFIG.windows[i].value=el,_update_code(WINDOW_CONFIG.windows[i])})}catch(error){alert("Failed to writing data: "+error)}compile()}))},reader.readAsArrayBuffer(blob)},fn()});