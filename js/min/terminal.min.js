class Terminal{#hash;#history=[];help=`
        <div>
            <pre>
<span class="token comment">-----------------------------</span>
    <span class="class-name token">Commands:</span>
        - window [add | remove] [:int]
            usage:
                window add 3
        
        - terminal [close | open]
            usage:
                terminal close
        
        - terminal [color | bg] [set | get | reset] [:hex | :rgb | :hsl]    (not implemented)
            usage:
                terminal color set #fff
        
        - config [set | get | reset]
            usage:
                config get

        - font [set | get | reset] [:int]
            usage:
                font set +3

        - theme [set | get | reset | list | import | export] [:string]
            usage:
                theme set dark

        - run [:int (windows: 0-3, default: 0)] [list]
            usage:
                run 1

        - execute [:int (windows: 0-3, default: 0)]
            usage:
                execute 0

        - cls
    
        - exit
    
        - help
    
    <span class="class-name token">More info:</span>
        <a href="https://github.com/ZhengLinLei/paste-code">https://github.com/ZhengLinLei/paste-code</a>
    
    <span class="class-name token">Issues:</span>
        <a href="https://github.com/ZhengLinLei/paste-code/issues">https://github.com/ZhengLinLei/paste-code/issues</a>
    
    <span class="class-name token">Author:</span>
        <a href="https://github.com/ZhengLinLei">Zheng Lin Lei</a>
<span class="token comment">-----------------------------</span>
            </pre>
        </div>
    `;executer={python:"https://pyscript.net/latest/pyscript.js",javascript:"./js/min/executer/executer.min.js",typescript:"https://unpkg.com/typescript@latest/lib/typescriptServices.js",brainfuck:"./js/min/executer/brainfuck.min.js",php:"./js/src/executer/php.js",java:"https://unpkg.com/java-to-javascript@latest/build/java-to-javascript.min.js",html:""};constructor(e){this.#hash=e}commands={window:["add","remove"],terminal:["close","open"],cls:0,exit:0,help:0,config:["set","get","reset"],font:["set","get","reset"],theme:["set","get","reset","list","import","export"],run:0,execute:0,a:0,yes:0};exec=n=>new Promise(e=>{var t=n.split(" ");this.#history.push(n),Object.keys(this.commands).includes(t[0])&&(0!=this.commands[t[0]]&&!this.commands[t[0]].includes(t[1])||e(this.execution[t[0]](t)),e([0,`Path "${t[1]}" not found`])),e([0,`Command "${t[0]}" not found`])});execution={terminal:e=>(this.#hash.terminal.toggleFnc(e[1]),[1,""]),window:t=>{let n=0;if(2<t.length){if(!parseInt(t[2]))return[0,"Invalid argument "+t[2]];n=parseInt(t[2])}else n=1;for(let e=0;e<n;e++)"add"==t[1]?this.#hash.window.add():this.#hash.window.remove();return[1,""]},exit:()=>(this.#hash.terminal.toggleFnc("close"),[1,""]),cls:()=>(this.#hash.terminal.output.innerHTML="",this.#hash.terminal.caret.style.transform="translateX(0px)",this.#hash.terminal.config.position=0,[1,""]),help:()=>[1,this.help],config:e=>{let t={},n=[1,`
                <br>
                <div>
                    <span>Reload required <a href="javascript:location.reload()">[yes]</a><a>[no]</a></span>
                </div>
                <br>
                `];switch(e[1]){case"set":t=JSON.parse(e.slice(2).join("")),Object.entries(t).forEach(([e,t])=>{"undefined"!==t&&"null"!==t&&"NaN"!==t||(n=[0,"Invalid value "+t]),"default"!=t?localStorage.setItem(e,t):localStorage.removeItem(e)});break;case"get":t={terminal:localStorage.getItem("terminal")||!1,terminalHeight:localStorage.getItem("terminalHeight")||"default",terminalOptWidth:localStorage.getItem("terminalOptWidth")||"default",fontSize:localStorage.getItem("fontSize")||"default",theme:localStorage.getItem("theme")||"default"},n=[1,`
                        <br>
                        <div>
                            <pre><code class="language-json">${Prism.highlight(JSON.stringify(t,null,4).trim(),Prism.languages.json,"json")}</code></pre>
                        </div>
                        <div>
                            <span>config set ${JSON.stringify(t)}</span>
                        </div>
                        <br>
                        `];break;case"reset":localStorage.clear()}return n},font:e=>{let t=[1,""],n=document.documentElement||document.querySelector(":root"),a=parseInt(window.getComputedStyle(n,null).getPropertyValue("font-size").replace("px",""));switch(e[1]){case"set":a=e[2].match(/[-+]/)?a+parseInt(e[2]):parseInt(e[2]);break;case"get":t=[1,`<br><div><span>Font size: <span class="token comment">${a}px</span></span></div><br>`];break;case"reset":a=12}return"get"!=e[1]&&n.style.setProperty("--font-size",a+"px"),localStorage.setItem("fontSize",a),t},theme:e=>{let t=[1,""];switch(e[1]){case"set":this.#hash.theme.list.includes(e[2])?this.#hash.theme.set(e[2]):t=[0,`Theme "${e[2]}" not found`];break;case"get":t=[1,`<div><span>Current theme: <span class="token comment">${localStorage.getItem("theme")||this.#hash.theme.list[0]}</span></span></div>`];break;case"reset":this.#hash.theme.set("light");break;case"list":t=[1,`<div><span>Theme list: <span class="token comment">${this.#hash.theme.list.join(", ")}</span></span><p>See <a href="https://github.com/ZhengLinLei/paste-code/blob/main/THEME.md">https://github.com/ZhengLinLei/paste-code/blob/main/THEME.md</a> to customise themes.</div>`];break;case"export":break;case"import":t=[1,`<div><p>Upload theme file</p><br><input onchange="alertModal('Changing theme')" type="file" accept="*.json, application/JSON, application/json"/></div><br>`]}return t},run:e=>{if(2<=e.length&&"list"==e[1])return[1,`<div><span>Executer supported languages: <span class="token comment">${Object.keys(this.executer).join(", ")}</span></span></div><br>`];var t=[0,`
                <div>
                    <span>Language not found.</span>
                </div>
                <div>
                    <span>Example: <span class="token comment">!PY</span>, <span class="token comment">!TS</span>, <span class="token comment">!JAVASCRIPT</span></span>
                </div>
                <br>
                <div>See <a href="https://github.com/ZhengLinLei/paste-code/blob/main/EXECUTER.md">https://github.com/ZhengLinLei/paste-code/blob/main/EXECUTER.md</a> for more information.</div>
            `],e=e[1]||0,n=this.#hash.window.config.windows[e];if(!n)return[0,`Window ${e} not found`];let s=n.value;e=s.split("\n");let a=this.#hash.window.getLang(n);if(!1===a)return t;let i=Object.entries({python:["python","py"],javascript:["javascript","js"],typescript:["typescript","ts"],brainfuck:["brainfuck","bf"],php:["php"],java:["java"],html:["html"]}).find(([,e])=>e.includes(a));if(!i)return[0,`Language "${a}" not executable. See <a href="https://github.com/ZhengLinLei/paste-code/blob/main/EXECUTER.md">https://github.com/ZhengLinLei/paste-code/blob/main/EXECUTER.md</a> for more information.`];i=i[0];n=this.executer[i];let r=document.querySelector(`script[src="${n}"]`),o=(r||((r=document.createElement("script")).setAttribute("defer","true"),r.src=n,document.body.appendChild(r)),`b${Math.random().toString(36).substring(7)}b`);function c(){document.querySelector("#"+o).innerHTML=""}function l(e){document.querySelector("#"+o).innerHTML+=e}switch(TMP_ID=o,this.#hash.terminal.output.innerHTML+=`<div id="${o}">Loading executer...</div>`,s=e.slice(1).join("\n"),i){case"python":function p(e){var t=document.createElement("py-script");t.style.opacity=0,t.innerHTML=`
                        from js import Out

                        ${s}
                        `,e.#hash.terminal.output.appendChild(t),c()}s=s.replace(/print\(/g,"Out("),"undefined"==typeof pyscript?r.onload=()=>{p(this)}:p(this);break;case"javascript":s=s.replace(/console.log\(/g,"Out("),c(),new JSexecuter(s).run();break;case"typescript":function h(){c();try{var e=window.ts.transpile(s);new JSexecuter(e).run()}catch(e){return l('<span class="token title important">Error TS</span>: '+e),[0,"Error executing"]}}s=s.replace(/console.log\(/g,"Out("),window.ts?h():r.onload=h;break;case"brainfuck":let n=[],a=[];function d(){var e=new Brainfuck(new Infinite);c(),e.code.source(s),e.onOutput(function(e){n.push(String.fromCharCode(e)),a.push(e)}),e.run(()=>{let t=`
                            <style>
                            td{
                                text-align: center;
                                padding-right: 10px;
                            }
                            </style>
                            <table>
                                <tr>
                            `;n.forEach(e=>t+=`<td>${e}</td>`),t+=`
                                </tr>
                                <tr>
                            `,a.forEach(e=>t+=`<td><span class="token comment">${e}</span></td>`),t+=`
                                </tr>
                            </table>
                            `,Out(t),Out(n.join(""))})}"undefined"==typeof Brainfuck?r.onload=d:d();break;case"php":var u=[];for(const f of new URLSearchParams(window.location.search).entries())u.push(`"${f[0]}" => "${f[1]}"`);function m(){var e=new PHP(s).vm.OUTPUT_BUFFER;c(),Out(e)}s=(s=s.replace("<?php","")).replace("?>",""),s=`<?php
                        $_GET = [${u.join(", ")}];
                    `+s+`
                    ?>
                    `,"undefined"==typeof PHP?r.onload=m:m();break;case"java":function g(){c();try{var e=window.javaToJavascript(s);e+=`
                            if(typeof Main === 'function'){
                                Main.main();
                            }
                            `,console.log(e),new JSexecuter(e).run()}catch(e){return l('<span class="token title important">Error Java</span>: '+e),[0,"Error executing"]}}s=s.replace(/System.out.println\(/g,"Out("),void 0===window.javaToJavascript?r.onload=g:g();break;case"html":document.open(),document.write(s),document.close()}return[1,""]},execute:e=>{var t;return 1<e.length&&e[1].includes("alert")?(e[1].includes("disable")?localStorage.setItem("disableAlertExec",!0):localStorage.removeItem("disableAlertExec"),[1,`
                <br>
                <div>
                    <span>Alert <span class="token title important">warning</span> updated</span>
                </div>
                <div>
                    <span class="token comment">Disable it with <span class="token operator">execute disable-alert</span>.<br> Or enable it with <span class="token operator">execute enable-alert</span></span>
                </div>
                <br>
                `]):"undefined"==typeof JSexecuter?((t=document.createElement("script")).setAttribute("defer","true"),t.src=this.executer.javascript,document.body.appendChild(t),[0,`Execution failed due: Script loading...; Please execute again <a>${e.join(" ")}</a>`]):(t=e[1]||0,(e=this.#hash.window.config.windows[t])?(e=`
                    function runModule(){
                        ${e.value}

                        return "Script Loaded";
                    }
                `,new JSexecuter(e).run(),localStorage.getItem("disableAlertExec")?[1,`
                <span class="comment token">${runModule()}</span>
                `]:[1,`
                        <br>
                        <div>
                            <span>This action could be dangerous. Are you sure you want to execute it? <a href="javascript:runModule()">[yes]</a><a>[no]</a></span>
                        </div>
                        <div>
                            <span class="token comment">By the way you can disable this alert with <span class="token operator">execute disable-alert</span>.<br> Or enable it with <span class="token operator">execute enable-alert</span></span>
                        </div>
                        <br>
                    `]):[0,`Window ${t} not found`])},a:()=>{var e;document.body.innerHTML=`
                    <div style="position:fixed;top:50%;left:50%;transform:translate(-50%, -50%);text-align:center;">
                        <h1>Waiting...</h1>
                    </div>
                `,(e=document.createElement("video")).style.width="100vw",e.style.height="100vh",e.style.position="fixed",e.style.top="0",e.style.left="0",e.style.objectFit="cover",e.src="https://shattereddisk.github.io/rickroll/rickroll.mp4",e.autoplay=!0,e.loop=!0,document.body.appendChild(e)},yes:e=>{let t=0,n=setInterval(()=>{this.#hash.terminal.output.innerHTML+=`y - ${t}<br>`,this.#hash.terminal.main.scrollTop=this.#hash.terminal.main.scrollHeight,t++},parseInt(e[1])||1),a=e=>{(e.altKey&&"c"==e.key||"Escape"==e.key||e.altKey&&"©"==e.key)&&(e.preventDefault(),clearInterval(n),this.#hash.terminal.output.innerHTML+="testing cancelled [Alt + C]<br>",document.removeEventListener("keydown",a))};return document.addEventListener("keydown",a),[1,""]}};getHistory(){return this.#history}}